jIO.addStorageType("local",function(a,e){a=a||{};var d,b,c;d=e.basicStorage(a,e);b={};c={getItem:function(f){var g=localStorage.getItem(f);return g===null?null:JSON.parse(g)},setItem:function(f,g){return localStorage.setItem(f,JSON.stringify(g))},removeItem:function(f){return localStorage.removeItem(f)}};b.username=a.username||"";b.application_name=a.application_name||"untitled";b.localpath="jio/localstorage/"+b.username+"/"+b.application_name;b.generateUuid=function(){var f=function(){var h,g=Math.floor(Math.random()*65536).toString(16);for(h=g.length;h<4;h+=1){g="0"+g}return g};return f()+f()+"-"+f()+"-"+f()+"-"+f()+"-"+f()+f()+f()};b.documentObjectUpdate=function(g,h){var f;for(f in g){if(g.hasOwnProperty(f)){if(f[0]!=="_"){delete g[f]}}}for(f in h){if(h.hasOwnProperty(f)){if(f[0]!=="_"){g[f]=h[f]}}}};b.objectIsEmpty=function(g){var f;for(f in g){if(g.hasOwnProperty(f)){return false}}return true};d.specToStore=function(){return{application_name:b.application_name,username:b.username}};d.validateState=function(){if(typeof b.username==="string"&&b.username!==""){return""}return'Need at least one parameter: "username".'};d.post=function(f){setTimeout(function(){var h,g=f.getDocId();if(!g){g=b.generateUuid()}h=c.getItem(b.localpath+"/"+g);if(h===null){c.setItem(b.localpath+"/"+g,f.cloneDoc());d.success({ok:true,id:g})}else{d.error({status:409,statusText:"Conflicts",error:"conflicts",message:"Cannot create a new document",reason:"Document already exists"})}})};d.put=function(f){setTimeout(function(){var g;g=c.getItem(b.localpath+"/"+f.getDocId());if(g===null){g=f.cloneDoc()}else{b.documentObjectUpdate(g,f.cloneDoc())}c.setItem(b.localpath+"/"+f.getDocId(),g);d.success({ok:true,id:f.getDocId()})})};d.putAttachment=function(f){setTimeout(function(){var g;g=c.getItem(b.localpath+"/"+f.getDocId());if(g===null){d.error({status:404,statusText:"Not Found",error:"not_found",message:"Impossible to add attachment",reason:"Document not found"});return}g._attachments=g._attachments||{};g._attachments[f.getAttachmentId()]={content_type:f.getAttachmentMimeType(),digest:"md5-"+f.md5SumAttachmentData(),length:f.getAttachmentLength()};c.setItem(b.localpath+"/"+f.getDocId()+"/"+f.getAttachmentId(),f.getAttachmentData());c.setItem(b.localpath+"/"+f.getDocId(),g);d.success({ok:true,id:f.getDocId(),attachment:f.getAttachmentId()})})};d.get=function(f){setTimeout(function(){var g=c.getItem(b.localpath+"/"+f.getDocId());if(g!==null){d.success(g)}else{d.error({status:404,statusText:"Not Found",error:"not_found",message:"Cannot find the document",reason:"Document does not exist"})}})};d.getAttachment=function(f){setTimeout(function(){var g=c.getItem(b.localpath+"/"+f.getDocId()+"/"+f.getAttachmentId());if(g!==null){d.success(g)}else{d.error({status:404,statusText:"Not Found",error:"not_found",message:"Cannot find the attachment",reason:"Attachment does not exist"})}})};d.remove=function(f){setTimeout(function(){var j,h,g;j=c.getItem(b.localpath+"/"+f.getDocId());g=[];if(j!==null&&typeof j==="object"){if(typeof j._attachments==="object"){for(h in j._attachments){if(j._attachments.hasOwnProperty(h)){g.push(h)}}}}else{return d.error({status:404,statusText:"Not Found",error:"not_found",message:"Document not found",reason:"missing"})}c.removeItem(b.localpath+"/"+f.getDocId());for(h=0;h<g.length;h+=1){c.removeItem(b.localpath+"/"+f.getDocId()+"/"+g[h])}d.success({ok:true,id:f.getDocId()})})};d.removeAttachment=function(f){setTimeout(function(){var k,g,j,h;g=function(i){d.error({status:404,statusText:"Not Found",error:"not_found",message:i+" not found",reason:"missing"})};k=c.getItem(b.localpath+"/"+f.getDocId());if(k!==null&&typeof k==="object"&&typeof k._attachments==="object"){if(typeof k._attachments[f.getAttachmentId()]==="object"){delete k._attachments[f.getAttachmentId()];if(b.objectIsEmpty(k._attachments)){delete k._attachments}c.setItem(b.localpath+"/"+f.getDocId(),k);c.removeItem(b.localpath+"/"+f.getDocId()+"/"+f.getAttachmentId());d.success({ok:true,id:f.getDocId(),attachment:f.getAttachmentId()})}else{g("Attachment")}}else{g("Document")}})};d.allDocs=function(h){var m,l,f,n=0,q=new RegExp("^"+b.localpath+"\\/[^/]+$"),o={},k=[],g,p=[];g=h.getOption("query");if(g===undefined){o.rows=[];for(m in localStorage){if(localStorage.hasOwnProperty(m)){if(q.test(m)){n+=1;l=m.split("/").slice(-1)[0];f={value:{}};f.id=l;f.key=l;if(h.getOption("include_docs")){f.doc=JSON.parse(localStorage.getItem(m))}o.rows.push(f)}}}o.total_rows=n;d.success(o)}else{for(m in localStorage){if(localStorage.hasOwnProperty(m)){if(q.test(m)){n+=1;l=m.split("/").slice(-1)[0];k.push(c.getItem(m))}}}p=jIO.ComplexQueries.query(g,k);d.success(p)}};return d});