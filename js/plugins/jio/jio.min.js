(function(l,j){var b;if(typeof localStorage!=="undefined"){b={getItem:function(n){var o=localStorage.getItem(n);return o===null?null:JSON.parse(o)},setItem:function(n,o){return localStorage.setItem(n,JSON.stringify(o))},removeItem:function(n){delete localStorage[n]},clone:function(){return JSON.parse(JSON.stringify(localStorage))}}}else{(function(){var n={};b={getItem:function(o){var p=n[o];return p===undefined?null:JSON.parse(n[o])},setItem:function(o,p){n[o]=JSON.stringify(p)},removeItem:function(o){delete n[o]},clone:function(){return JSON.parse(JSON.stringify(n))}}}())}var c=function(n,p){var o={};n=n||{};p=p||{};o.name="jioException";o.message=n.message||"Unknown Reason.";o.toString=function(){return o.name+": "+o.message};return o};var m=function(n,p){var o=c(n,p),q=n.command;n=n||{};o.name="invalidCommandState";o.toString=function(){return o.name+": "+q.getLabel()+", "+o.message};return o};var d=function(n,q){var p=c(n,q),o=n.storage.getType();n=n||{};p.name="invalidStorage";p.toString=function(){return p.name+': Type "'+o+'", '+p.message};return p};var g=function(n,q){var p=c(n,q),o=n.type;p.name="invalidStorageType";p.toString=function(){return p.name+": "+o+", "+p.message};return p};var k=function(n,p){var o=c(n,p);o.name="jobNotReadyException";return o};var h=function(n,p){var o=c(n,p);o.name="tooMuchTriesJobException";return o};var a=function(n,p){var o=c(n,p);o.name="invalidJobException";return o};var i=function(w){var I=function(Q,T){var S={},R={};Q=Q||{};T=T||{};R.type=Q.type||"";Object.defineProperty(S,"getType",{configurable:false,enumerable:false,writable:false,value:function(){return R.type}});S.execute=function(U){S.success=U.success;S.error=U.error;S.retry=U.retry;S.end=U.end;if(S.validate(U)){U.executeOn(S)}};S.isValid=function(){return true};S.validate=function(){var U=S.validateState();if(U){S.error({status:0,statusText:"Invalid Storage",error:"invalid_storage",message:U,reason:U});return false}return true};S.serialized=function(){var U=S.specToStore()||{};U.type=S.getType();return U};S.specToStore=function(){return{}};S.validateState=function(){return""};S.post=function(){setTimeout(function(){S.error({status:0,statusText:"Not Implemented",error:"not_implemented",message:'"Post" command is not implemented',reason:"Command not implemented"})})};S.put=function(){setTimeout(function(){S.error({status:0,statusText:"Not Implemented",error:"not_implemented",message:'"Put" command is not implemented',reason:"Command not implemented"})})};S.putAttachment=function(){setTimeout(function(){S.error({status:0,statusText:"Not Implemented",error:"not_implemented",message:'"PutAttachment" command is not implemented',reason:"Command not implemented"})})};S.get=function(){setTimeout(function(){S.error({status:0,statusText:"Not Implemented",error:"not_implemented",message:'"Get" command is not implemented',reason:"Command not implemented"})})};S.allDocs=function(){setTimeout(function(){S.error({status:0,statusText:"Not Implemented",error:"not_implemented",message:'"AllDocs" command is not implemented',reason:"Command not implemented"})})};S.remove=function(){setTimeout(function(){S.error({status:0,statusText:"Not Implemented",error:"not_implemented",message:'"Remove" command is not implemented',reason:"Command not implemented"})})};S.check=function(U){setTimeout(function(){S.success({ok:true,id:U.getDocId()})})};S.repair=function(U){setTimeout(function(){S.success({ok:true,id:U.getDocId()})})};S.success=function(){};S.retry=function(){};S.error=function(){};S.end=function(){};R.newCommand=function(W,U){var V=U||{};V.label=W;return p(V,T)};R.storage=T.storage;delete T.storage;S.addJob=function(aa,W,X,V,Z,U){var Y={doc:X,options:V,callbacks:{success:Z,error:U}};s.addJob(u({storage:R.storage(W||{}),command:R.newCommand(aa,Y)},T))};return S};var C=function(Q,S){var R=p(Q,S);Q=Q||{};S=S||{};R.getLabel=function(){return"allDocs"};R.executeOn=function(T){T.allDocs(R)};R.canBeRestored=function(){return false};R.validateState=function(){return true};return R};var o=function(Q,S){var R=p(Q,S);Q=Q||{};S=S||{};R.getLabel=function(){return"check"};R.validateState=function(){if(!(typeof R.getDocId()==="string"&&R.getDocId()!=="")){R.error({status:20,statusText:"Document Id Required",error:"document_id_required",message:"The document id is not provided",reason:"Document id is undefined"});return false}return true};R.executeOn=function(T){T.check(R)};R.canBeRestored=function(){return false};return R};var p=function(Q,T){var S={},R={};Q=Q||{};T=T||{};R.commandlist={post:J,put:F,get:A,remove:K,allDocs:C,getAttachment:n,putAttachment:t,removeAttachment:q,check:o,repair:M};if(Q.label&&R.commandlist[Q.label]){R.label=Q.label;delete Q.label;return R.commandlist[R.label](Q,T)}R.tried=0;R.doc=Q.doc||{};if(typeof R.doc!=="object"){R.doc={_id:R.doc.toString()}}R.option=Q.options||{};R.callbacks=Q.callbacks||{};R.success=[R.callbacks.success||function(){}];R.error=[R.callbacks.error||function(){}];R.retry=function(){S.error({status:13,statusText:"Fail Retry",error:"fail_retry",message:"Impossible to retry.",reason:"Impossible to retry."})};R.end=function(){};R.on_going=false;S.serialized=function(){var U={};U.label=S.getLabel();U.tried=R.tried;U.doc=S.cloneDoc();U.option=S.cloneOption();return U};S.getLabel=function(){return"command"};S.getDocId=function(){return R.doc._id};S.getAttachmentId=function(){return R.doc._attachment};S.getAttachmentData=function(){return R.doc._data||""};S.getAttachmentLength=function(){return(R.doc._data||"").length};S.getAttachmentMimeType=function(){return R.doc._mimetype};S.md5SumAttachmentData=function(){return j(R.doc._data||"")};S.getDocInfo=function(U){return R.doc[U]};S.getOption=function(U){return R.option[U]};S.validate=function(U){if(typeof R.doc._id==="string"&&!R.doc._id.match("^[^/]+([/][^/]+)?$")){S.error({status:21,statusText:"Invalid Document Id",error:"invalid_document_id",message:'The document id must be like "abc" or "abc/def".',reason:'The document id is no like "abc" or "abc/def"'});return false}if(!S.validateState()){return false}return U.validate()};S.validateState=function(){return true};S.canBeRetried=function(){return(R.option.max_retry===undefined||R.option.max_retry===0||R.tried<R.option.max_retry)};S.getTried=function(){return R.tried};S.execute=function(U){if(!R.on_going){if(S.validate(U)){R.tried+=1;R.on_going=true;U.execute(S)}}};S.executeOn=function(U){};S.success=function(U){var V;R.on_going=false;for(V=0;V<R.success.length;V+=1){R.success[V](U)}R.end(H());R.success=[];R.error=[]};S.retry=function(U){R.on_going=false;if(S.canBeRetried()){R.retry()}else{S.error(U)}};S.error=function(V){var U;R.on_going=false;for(U=0;U<R.error.length;U+=1){R.error[U](V)}R.end(N());R.success=[];R.error=[]};S.end=function(){R.end(H())};S.addCallbacks=function(V,U){if(arguments.length>1){R.success.push(V||function(){});R.error.push(U||function(){})}else{R.success.push(function(W){(V||function(){})(undefined,W)});R.error.push(function(W){(V||function(){})(W,undefined)})}};S.onSuccessDo=function(U){if(U){R.success=U}else{return R.success}};S.onErrorDo=function(U){if(U){R.error=U}else{return R.error}};S.onEndDo=function(U){R.end=U};S.onRetryDo=function(U){R.retry=U};S.canBeRestored=function(){return true};S.clone=function(){return p(S.serialized(),T)};S.cloneOption=function(){return JSON.parse(JSON.stringify(R.option))};S.cloneDoc=function(){return JSON.parse(JSON.stringify(R.doc))};return S};var n=function(Q,S){var R=p(Q,S);Q=Q||{};S=S||{};R.getLabel=function(){return"getAttachment"};R.executeOn=function(T){T.getAttachment(R)};R.validateState=function(){if(!(typeof R.getDocId()==="string"&&R.getDocId()!=="")){R.error({status:20,statusText:"Document Id Required",error:"document_id_required",message:"The document id is not provided",reason:"Document id is undefined"});return false}if(typeof R.getAttachmentId()!=="string"){R.error({status:22,statusText:"Attachment Id Required",error:"attachment_id_required",message:"The attachment id must be set",reason:"Attachment id not set"});return false}if(R.getAttachmentId()===""){R.error({status:23,statusText:"Invalid Attachment Id",error:"invalid_attachment_id",message:"The attachment id must not be an empty string",reason:"Attachment id is empty"})}return true};return R};var A=function(Q,S){var R=p(Q,S);Q=Q||{};S=S||{};R.getLabel=function(){return"get"};R.validateState=function(){if(!(typeof R.getDocId()==="string"&&R.getDocId()!=="")){R.error({status:20,statusText:"Document Id Required",error:"document_id_required",message:"The document id is not provided",reason:"Document id is undefined"});return false}return true};R.executeOn=function(T){T.get(R)};R.canBeRestored=function(){return false};return R};var J=function(Q,S){var R=p(Q,S);Q=Q||{};S=S||{};R.getLabel=function(){return"post"};R.validateState=function(){return true};R.executeOn=function(T){T.post(R)};return R};var t=function(Q,S){var R=p(Q,S);Q=Q||{};S=S||{};R.getLabel=function(){return"putAttachment"};R.executeOn=function(T){T.putAttachment(R)};R.validateState=function(){if(!(typeof R.getDocId()==="string"&&R.getDocId()!=="")){R.error({status:20,statusText:"Document Id Required",error:"document_id_required",message:"The document id is not provided",reason:"Document id is undefined"});return false}if(typeof R.getAttachmentId()!=="string"){R.error({status:22,statusText:"Attachment Id Required",error:"attachment_id_required",message:"The attachment id must be set",reason:"Attachment id not set"});return false}if(R.getAttachmentId()===""){R.error({status:23,statusText:"Invalid Attachment Id",error:"invalid_attachment_id",message:"The attachment id must not be an empty string",reason:"Attachment id is empty"})}return true};return R};var F=function(Q,S){var R=p(Q,S);Q=Q||{};S=S||{};R.getLabel=function(){return"put"};R.validateState=function(){if(!(typeof R.getDocId()==="string"&&R.getDocId()!=="")){R.error({status:20,statusText:"Document Id Required",error:"document_id_required",message:"The document id is not provided",reason:"Document id is undefined"});return false}return true};R.executeOn=function(T){T.put(R)};return R};var q=function(Q,S){var R=p(Q,S);Q=Q||{};S=S||{};R.getLabel=function(){return"removeAttachment"};R.executeOn=function(T){T.removeAttachment(R)};R.validateState=function(){if(!(typeof R.getDocId()==="string"&&R.getDocId()!=="")){R.error({status:20,statusText:"Document Id Required",error:"document_id_required",message:"The document id is not provided",reason:"Document id is undefined"});return false}if(typeof R.getAttachmentId()!=="string"){R.error({status:22,statusText:"Attachment Id Required",error:"attachment_id_required",message:"The attachment id must be set",reason:"Attachment id not set"});return false}if(R.getAttachmentId()===""){R.error({status:23,statusText:"Invalid Attachment Id",error:"invalid_attachment_id",message:"The attachment id must not be an empty string",reason:"Attachment id is empty"})}return true};return R};var K=function(Q,S){var R=p(Q,S);Q=Q||{};S=S||{};R.getLabel=function(){return"remove"};R.validateState=function(){if(!(typeof R.getDocId()==="string"&&R.getDocId()!=="")){R.error({status:20,statusText:"Document Id Required",error:"document_id_required",message:"The document id is not provided",reason:"Document id is undefined"});return false}return true};R.executeOn=function(T){T.remove(R)};return R};var M=function(Q,S){var R=p(Q,S);Q=Q||{};S=S||{};R.getLabel=function(){return"repair"};R.validateState=function(){if(!(typeof R.getDocId()==="string"&&R.getDocId()!=="")){R.error({status:20,statusText:"Document Id Required",error:"document_id_required",message:"The document id is not provided",reason:"Document id is undefined"});return false}return true};R.executeOn=function(T){T.repair(R)};return R};var H=function(Q,S){var R=D(Q,S);Q=Q||{};S=S||{};R.getLabel=function(){return"done"};R.canStart=function(){return false};R.canRestart=function(){return false};R.isDone=function(){return true};return R};var N=function(Q,S){var R=D(Q,S);Q=Q||{};S=S||{};R.getLabel=function(){return"fail"};R.canStart=function(){return false};R.canRestart=function(){return true};return R};var G=function(Q,S){var R=D(Q,S);Q=Q||{};S=S||{};R.getLabel=function(){return"initial"};R.canStart=function(){return true};R.canRestart=function(){return true};return R};var D=function(Q,S){var R={};Q=Q||{};S=S||{};R.getLabel=function(){return"job status"};R.canStart=function(){};R.canRestart=function(){};R.serialized=function(){return{label:R.getLabel()}};R.isWaitStatus=function(){return false};R.isDone=function(){return false};return R};var x=function(Q,S){var R=D(Q,S);Q=Q||{};S=S||{};R.getLabel=function(){return"on going"};R.canStart=function(){return false};R.canRestart=function(){return false};return R};var L=function(Q,T){var S=D(Q,T),R={};Q=Q||{};T=T||{};R.job_id_array=Q.job_id_array||[];R.threshold=0;S.getLabel=function(){return"wait"};R.refreshJobIdArray=function(){var V=[],U;for(U=0;U<R.job_id_array.length;U+=1){if(s.jobIdExists(R.job_id_array[U])){V.push(R.job_id_array[U])}}R.job_id_array=V};S.waitForJob=function(V){var U;for(U=0;U<R.job_id_array.length;U+=1){if(R.job_id_array[U]===V.getId()){return}}R.job_id_array.push(V.getId())};S.dontWaitForJob=function(W){var V,U=[];for(V=0;V<R.job_id_array.length;V+=1){if(R.job_id_array[V]!==W.getId()){U.push(R.job_id_array[V])}}R.job_id_array=U};S.waitForTime=function(U){R.threshold=Date.now()+U};S.stopWaitForTime=function(){R.threshold=0};S.canStart=function(){R.refreshJobIdArray();return(R.job_id_array.length===0&&Date.now()>=R.threshold)};S.canRestart=function(){return S.canStart()};S.serialized=function(){return{label:S.getLabel(),waitfortime:R.threshold,waitforjob:R.job_id_array}};S.isWaitStatus=function(){return true};return S};var u=function(Q){var S={},R={};Q=Q||{};R.id=E.nextId();R.command=Q.command;R.storage=Q.storage;R.status=G();R.date=new Date();if(!R.storage){throw a({job:S,message:"No storage set"})}if(!R.command){throw a({job:S,message:"No command set"})}S.getCommand=function(){return R.command};S.getStatus=function(){return R.status};S.getId=function(){return R.id};S.getStorage=function(){return R.storage};S.getDate=function(){return R.date};S.isReady=function(){if(R.command.getTried()===0){return R.status.canStart()}return R.status.canRestart()};S.serialized=function(){return{id:R.id,date:R.date.getTime(),status:R.status.serialized(),command:R.command.serialized(),storage:R.storage.serialized()}};S.waitForJob=function(T){if(R.status.getLabel()!=="wait"){R.status=L({})}R.status.waitForJob(T)};S.dontWaitFor=function(T){if(R.status.getLabel()==="wait"){R.status.dontWaitForJob(T)}};S.waitForTime=function(T){if(R.status.getLabel()!=="wait"){R.status=L({})}R.status.waitForTime(T)};S.stopWaitForTime=function(){if(R.status.getLabel()==="wait"){R.status.stopWaitForTime()}};S.eliminated=function(){R.command.error({status:10,statusText:"Stopped",error:"stopped",message:"This job has been stopped by another one.",reason:"this job has been stopped by another one"})};S.notAccepted=function(){R.command.onEndDo(function(){R.status=N();s.terminateJob(S)});R.command.error({status:11,statusText:"Not Accepted",error:"not_accepted",message:"This job is already running.",reason:"this job is already running"})};S.update=function(T){R.command.addCallbacks(T.getCommand().onSuccessDo()[0],T.getCommand().onErrorDo()[0]);R.date=new Date(T.getDate().getTime())};S.execute=function(){if(!S.getCommand().canBeRetried()){throw h({job:S,message:"The job was invoked too much time."})}if(!S.isReady()){throw k({job:S,message:"Can not execute this job."})}R.status=x();R.command.onRetryDo(function(){var T=R.command.getTried();T=T*T*200;if(T>10000){T=10000}S.waitForTime(T)});R.command.onEndDo(function(T){R.status=T;s.terminateJob(S)});R.command.execute(R.storage)};return S};var P=function(Q,T){var S={},U=[],R=Q.announcer||{};Q=Q||{};T=T||{};S.add=function(V){U.push(V)};S.remove=function(X){var W,V=[];for(W=0;W<U.length;W+=1){if(U[W]!==X){V.push(U[W])}}U=V};S.register=function(){R.register(S)};S.unregister=function(){R.unregister(S)};S.trigger=function(V){var W;for(W=0;W<U.length;W+=1){U[W].apply(null,V)}};return S};var r=(function(Q,T){var S={},R={};Q=Q||{};T=T||{};R.id=Q.id||0;R.interval=400;R.interval_id=null;R.touch=function(){b.setItem("jio/id/"+R.id,Date.now())};S.setId=function(U){R.id=U};S.setIntervalDelay=function(U){R.interval=U};S.getIntervalDelay=function(){return R.interval};S.start=function(){if(!R.interval_id){R.touch();R.interval_id=setInterval(function(){R.touch()},R.interval)}};S.stop=function(){if(R.interval_id!==null){clearInterval(R.interval_id);R.interval_id=null}};return S}());var y=(function(Q,T){var R={},S={};Q=Q||{};T=T||{};R.register=function(U){if(!S[U]){S[U]=P()}};R.unregister=function(U){if(S[U]){delete S[U]}};R.at=function(U){return S[U]};R.on=function(U,V){R.register(U);R.at(U).add(V)};R.trigger=function(V,U){R.at(V).trigger(U)};return R}());var E=(function(Q){var R={},S=0;Q=Q||{};R.nextId=function(){S=S+1;return S};return R}());var s=(function(R){var T={},Q="jio/job_array",S={};R=R||{};S.id=R.id;S.interval_id=null;S.interval=200;S.job_array=[];S.getJobArrayName=function(){return Q+"/"+S.id};S.getJobArray=function(){return b.getItem(S.getJobArrayName())||[]};S.copyJobArrayToLocal=function(){var V=[],U;for(U=0;U<S.job_array.length;U+=1){V.push(S.job_array[U].serialized())}b.setItem(S.getJobArrayName(),V)};S.removeJob=function(V){var U,W=[];for(U=0;U<S.job_array.length;U+=1){if(S.job_array[U]!==V){W.push(S.job_array[U])}}S.job_array=W;S.copyJobArrayToLocal()};T.setId=function(U){S.id=U};T.start=function(){var U;if(S.interval_id===null){S.interval_id=setInterval(function(){S.restoreOldJio();for(U=0;U<S.job_array.length;U+=1){T.execute(S.job_array[U])}},S.interval)}};T.stop=function(){if(S.interval_id!==null){clearInterval(S.interval_id);S.interval_id=null;if(S.job_array.length===0){b.removeItem(S.getJobArrayName())}}};S.restoreOldJio=function(){var U,V;S.lastrestore=S.lastrestore||0;if(S.lastrestore>(Date.now())-2000){return}V=b.getItem("jio/id_array")||[];for(U=0;U<V.length;U+=1){S.restoreOldJioId(V[U])}S.lastrestore=Date.now()};S.restoreOldJioId=function(V){var U;U=b.getItem("jio/id/"+V)||0;if(new Date(U).getTime()<(Date.now()-10000)){S.restoreOldJobFromJioId(V);S.removeOldJioId(V);S.removeJobArrayFromJioId(V)}};S.restoreOldJobFromJioId=function(X){var V,U,W;W=b.getItem("jio/job_array/"+X)||[];for(V=0;V<W.length;V+=1){U=p(W[V].command);if(U.canBeRestored()){T.addJob(u({storage:T.storage(W[V].storage),command:U}))}}};S.removeOldJioId=function(X){var V,U,W=[];U=b.getItem("jio/id_array")||[];for(V=0;V<U.length;V+=1){if(U[V]!==X){W.push(U[V])}}b.setItem("jio/id_array",W);b.removeItem("jio/id/"+X)};S.removeJobArrayFromJioId=function(U){b.removeItem("jio/job_array/"+U)};T.execute=function(U){try{U.execute()}catch(V){switch(V.name){case"jobNotReadyException":break;case"tooMuchTriesJobException":break;default:throw V}}S.copyJobArrayToLocal()};T.jobIdExists=function(V){var U;for(U=0;U<S.job_array.length;U+=1){if(S.job_array[U].getId()===V){return true}}return false};T.terminateJob=function(U){S.removeJob(U)};T.addJob=function(V){var U=T.validateJobAccordingToJobList(S.job_array,V);S.appendJob(V,U)};T.validateJobAccordingToJobList=function(V,X){var W,U=[];for(W=0;W<V.length;W+=1){U.push(z.validateJobAccordingToJob(V[W],X))}return U};S.appendJob=function(W,U){var V;if(S.job_array.length!==U.length){throw new RangeError("Array out of bound")}for(V=0;V<U.length;V+=1){if(U[V].action==="dont accept"){return W.notAccepted()}}for(V=0;V<U.length;V+=1){switch(U[V].action){case"eliminate":U[V].job.eliminated();S.removeJob(U[V].job);break;case"update":U[V].job.update(W);S.copyJobArrayToLocal();return;case"wait":W.waitForJob(U[V].job);break;default:break}}S.job_array.push(W);S.copyJobArrayToLocal()};T.serialized=function(){var U=[],W,V=S.job_array||[];for(W=0;W<V.length;W+=1){U.push(V[W].serialized())}return U};return T}());var z=(function(){var R={},Q={};Q.compare={};Q.action={};Object.defineProperty(R,"eliminate",{configurable:false,enumerable:false,writable:false,value:function(){return"eliminate"}});Object.defineProperty(R,"update",{configurable:false,enumerable:false,writable:false,value:function(){return"update"}});Object.defineProperty(R,"dontAccept",{configurable:false,enumerable:false,writable:false,value:function(){return"dont accept"}});Object.defineProperty(R,"wait",{configurable:false,enumerable:false,writable:false,value:function(){return"wait"}});Object.defineProperty(R,"ok",{configurable:false,enumerable:false,writable:false,value:function(){return"none"}});R.default_action=R.ok;R.default_compare=function(S,T){return S.getId()!==T.getId()&&S.getStatus().getLabel()!=="done"&&S.getStatus().getLabel()!=="fail"&&JSON.stringify(S.getStorage().serialized())===JSON.stringify(T.getStorage().serialized())};Object.defineProperty(R,"sameDocumentId",{configurable:false,enumerable:false,writable:false,value:function(S,T){return S.getCommand().getDocId()===T.getCommand().getDocId()}});Object.defineProperty(R,"sameRevision",{configurable:false,enumerable:false,writable:false,value:function(S,T){return S.getCommand().getDocInfo("_rev")===T.getCommand().getDocInfo("_rev")}});Object.defineProperty(R,"sameAttachmentId",{configurable:false,enumerable:false,writable:false,value:function(S,T){return S.getCommand().getAttachmentId()===T.getCommand().getAttachmentId()}});Object.defineProperty(R,"sameDocument",{configurable:false,enumerable:false,writable:false,value:function(S,T){return JSON.stringify(S.getCommand().cloneDoc())===JSON.stringify(T.getCommand().cloneDoc())}});Object.defineProperty(R,"sameOption",{configurable:false,enumerable:false,writable:false,value:function(S,T){return JSON.stringify(S.getCommand().cloneOption())===JSON.stringify(T.getCommand().cloneOption())}});Q.getAction=function(V,U){var T,S,X=Q.action,Y,W,Z=[],aa;T=V.getCommand().getLabel();S=U.getCommand().getLabel();X=X[T]=X[T]||{};X=X[S]=X[S]||[];for(Y=0;Y<X.length;Y+=1){Z=X[Y].condition_list;aa=true;for(W=0;W<Z.length;W+=1){if(!Z[W](V,U)){aa=false;break}}if(aa){return X[Y].rule()}}return R.default_action()};Q.canCompare=function(S,V){var U,T;U=S.getCommand().getLabel();T=V.getCommand().getLabel();if(Q.compare[U]&&Q.compare[U][T]){return Q.compare[U][T](S,V)}return R.default_compare(S,V)};Object.defineProperty(R,"validateJobAccordingToJob",{configurable:false,enumerable:false,writable:false,value:function(S,T){if(Q.canCompare(S,T)){return{action:Q.getAction(S,T),job:S}}return{action:R.default_action(S,T),job:S}}});Object.defineProperty(R,"addActionRule",{configurable:false,enumerable:false,writable:false,value:function(U,S,T,W){var V=Q.action;V=V[U]=V[U]||{};V=V[S]=V[S]||[];V.push({condition_list:T,rule:W})}});Object.defineProperty(R,"addCompareRule",{configurable:false,enumerable:false,writable:false,value:function(T,S,U){Q.compare[T]=Q.compare[T]||{};Q.compare[T][S]=U}});R.addActionRule("post","post",[R.sameDocument],R.update);R.addActionRule("post","post",[R.sameDocumentId,R.sameRevision],R.wait);R.addActionRule("post","put",[R.sameDocument],R.update);R.addActionRule("post","put",[R.sameDocumentId,R.sameRevision],R.wait);R.addActionRule("post","putAttachment",[R.sameDocumentId,R.sameRevision],R.wait);R.addActionRule("post","remove",[R.sameDocumentId,R.sameRevision],R.wait);R.addActionRule("put","post",[R.sameDocument],R.update);R.addActionRule("put","post",[R.sameDocumentId,R.sameRevision],R.wait);R.addActionRule("put","put",[R.sameDocument],R.update);R.addActionRule("put","put",[R.sameDocumentId,R.sameRevision],R.wait);R.addActionRule("put","putAttachment",[R.sameDocumentId,R.sameRevision],R.wait);R.addActionRule("put","remove",[R.sameDocumentId,R.sameRevision],R.wait);R.addActionRule("putAttachment","post",[R.sameDocumentId,R.sameRevision],R.wait);R.addActionRule("putAttachment","put",[R.sameDocumentId,R.sameRevision],R.wait);R.addActionRule("putAttachment","putAttachment",[R.sameDocument],R.update);R.addActionRule("putAttachment","putAttachment",[R.sameDocumentId,R.sameRevision,R.sameAttachmentId],R.wait);R.addActionRule("putAttachment","remove",[R.sameDocumentId,R.sameRevision],R.wait);R.addActionRule("remove","post",[R.sameDocumentId,R.sameRevision],R.wait);R.addActionRule("remove","put",[R.sameDocumentId,R.sameRevision],R.wait);R.addActionRule("remove","putAttachment",[R.sameDocumentId,R.sameRevision],R.wait);R.addActionRule("remove","remove",[R.sameDocumentId,R.sameRevision],R.update);R.addActionRule("get","get",[R.sameDocument,R.sameOption],R.update);R.addActionRule("getAttachment","getAttachment",[R.sameDocument,R.sameOption],R.update);R.addActionRule("allDocs","allDocs",[R.sameDocument,R.sameOption],R.update);return R}());var v={},O={},B="jio/id_array";w=w||{};O.id=null;O.storage_spec=w;O.environments={};O.init=function(){if(O.id===null){var Q,R=b.getItem(B)||[];O.id=1;for(Q=0;Q<R.length;Q+=1){if(R[Q]>=O.id){O.id=R[Q]+1}}R.push(O.id);b.setItem(B,R);r.setId(O.id);s.setId(O.id)}};Object.defineProperty(v,"storage",{configurable:false,enumerable:false,writable:false,value:function(Q,S,U){var T,R;Q=Q||{};S=S||{};S.basicStorage=I;T=JSON.stringify(Q);O.environments[T]=O.environments[T]||{};S.env=O.environments[T];S.storage=v.storage;R=U||Q.type||"base";if(R==="base"){return I(Q,S)}if(!f[R]){throw g({type:R,message:"Storage does not exists."})}return f[R](Q,S)}});s.storage=v.storage;Object.defineProperty(v,"start",{configurable:false,enumerable:false,writable:false,value:function(){O.init();r.start();s.start()}});Object.defineProperty(v,"stop",{configurable:false,enumerable:false,writable:false,value:function(){s.stop()}});Object.defineProperty(v,"close",{configurable:false,enumerable:false,writable:false,value:function(){r.stop();s.stop();O.id=null}});Object.defineProperty(v,"getId",{configurable:false,enumerable:false,writable:false,value:function(){return O.id}});Object.defineProperty(v,"getJobRules",{configurable:false,enumerable:false,writable:false,value:function(){return z}});Object.defineProperty(v,"validateStorageDescription",{configurable:false,enumerable:false,writable:false,value:function(Q){return v.storage(Q).isValid()}});Object.defineProperty(v,"getJobArray",{configurable:false,enumerable:false,writable:false,value:function(){return s.serialized()}});O.makeCallbacks=function(S,R,Q){S.callback=function(T,U){if(T){S.error(T)}else{S.success(U)}};S.success=function(T){S.callback(undefined,T)};S.error=function(T){S.callback(T,undefined)};if(typeof R==="function"){if(typeof Q==="function"){S.success=R;S.error=Q}else{S.callback=R}}else{S.callback=function(){}}};O.parametersToObject=function(T,V){var Q,R=0,S=[],U={options:{}};for(R=0;R<T.length;R+=1){if(typeof T[R]==="object"){U.options=T[R];for(Q in V){if((typeof V[Q])!==(typeof T[R][Q])){U.options[Q]=V[Q]}}}if(typeof T[R]==="function"){S.push(T[R])}}O.makeCallbacks(U,S[0],S[1]);return U};O.addJob=function(R,Q){s.addJob(u({storage:v.storage(O.storage_spec),command:R(Q)}))};Object.defineProperty(v,"post",{configurable:false,enumerable:false,writable:false,value:function(S,R,U,Q){var T=O.parametersToObject([R,U,Q],{max_retry:0});O.addJob(J,{doc:S,options:T.options,callbacks:{success:T.success,error:T.error}})}});Object.defineProperty(v,"put",{configurable:false,enumerable:false,writable:false,value:function(S,R,U,Q){var T=O.parametersToObject([R,U,Q],{max_retry:0});O.addJob(F,{doc:S,options:T.options,callbacks:{success:T.success,error:T.error}})}});Object.defineProperty(v,"get",{configurable:false,enumerable:false,writable:false,value:function(S,R,U,Q){var T=O.parametersToObject([R,U,Q],{max_retry:3});O.addJob(A,{doc:S,options:T.options,callbacks:{success:T.success,error:T.error}})}});Object.defineProperty(v,"remove",{configurable:false,enumerable:false,writable:false,value:function(R,Q,T,U){var S=O.parametersToObject([Q,T,U],{max_retry:0});O.addJob(K,{doc:R,options:S.options,callbacks:{success:S.success,error:S.error}})}});Object.defineProperty(v,"allDocs",{configurable:false,enumerable:false,writable:false,value:function(R,T,Q){var S=O.parametersToObject([R,T,Q],{max_retry:3});O.addJob(C,{options:S.options,callbacks:{success:S.success,error:S.error}})}});Object.defineProperty(v,"getAttachment",{configurable:false,enumerable:false,writable:false,value:function(S,R,U,Q){var T=O.parametersToObject([R,U,Q],{max_retry:3});O.addJob(n,{doc:S,options:T.options,callbacks:{success:T.success,error:T.error}})}});Object.defineProperty(v,"putAttachment",{configurable:false,enumerable:false,writable:false,value:function(S,R,U,Q){var T=O.parametersToObject([R,U,Q],{max_retry:0});O.addJob(t,{doc:S,options:T.options,callbacks:{success:T.success,error:T.error}})}});Object.defineProperty(v,"removeAttachment",{configurable:false,enumerable:false,writable:false,value:function(S,R,U,Q){var T=O.parametersToObject([R,U,Q],{max_retry:0});O.addJob(q,{doc:S,options:T.options,callbacks:{success:T.success,error:T.error}})}});Object.defineProperty(v,"check",{configurable:false,enumerable:false,writable:false,value:function(R,Q,T,U){var S=O.parametersToObject([Q,T,U],{max_retry:3});O.addJob(o,{doc:R,options:S.options,callbacks:{success:S.success,error:S.error}})}});Object.defineProperty(v,"repair",{configurable:false,enumerable:false,writable:false,value:function(R,Q,T,U){var S=O.parametersToObject([Q,T,U],{max_retry:3});O.addJob(M,{doc:R,options:S.options,callbacks:{success:S.success,error:S.error}})}});return v};var f={base:function(){}};var e=(function(n){var o={};n=n||{};Object.defineProperty(o,"newJio",{configurable:false,enumerable:false,writable:false,value:function(q){var r=q,p=null;if(typeof r==="string"){r=JSON.parse(r)}else{r=JSON.stringify(r);if(r!==undefined){r=JSON.parse(r)}}r=r||{type:"base"};p=i(r);p.start();return p}});Object.defineProperty(o,"addStorageType",{configurable:false,enumerable:false,writable:false,value:function(q,p){p=p||function(){return null};if(f[q]){throw g({type:q,message:"Already known."})}f[q]=p}});return o}());Object.defineProperty(l,"jIO",{configurable:false,enumerable:false,writable:false,value:e})}(window,hex_md5));