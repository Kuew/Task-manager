(function(a){Object.defineProperty(a,"ComplexQueries",{configurable:false,enumerable:false,writable:false,value:{}});Object.defineProperty(a.ComplexQueries,"parse",{configurable:false,enumerable:false,writable:false,value:function(m){var e=false;var n=new String();function d(i){n+=i+"\n"}function l(u){var t=0;var i=-1;var s=0;var w=0;var v=u.offset+1;do{v--;t=0;i=-2;w=v;if(u.src.length<=w){return 19}do{switch(t){case 0:if((u.src.charCodeAt(v)>=0&&u.src.charCodeAt(v)<=8)||(u.src.charCodeAt(v)>=10&&u.src.charCodeAt(v)<=31)||u.src.charCodeAt(v)==33||(u.src.charCodeAt(v)>=35&&u.src.charCodeAt(v)<=39)||(u.src.charCodeAt(v)>=42&&u.src.charCodeAt(v)<=57)||u.src.charCodeAt(v)==59||(u.src.charCodeAt(v)>=63&&u.src.charCodeAt(v)<=64)||(u.src.charCodeAt(v)>=66&&u.src.charCodeAt(v)<=77)||(u.src.charCodeAt(v)>=80&&u.src.charCodeAt(v)<=254)){t=1}else{if(u.src.charCodeAt(v)==9){t=2}else{if(u.src.charCodeAt(v)==40){t=3}else{if(u.src.charCodeAt(v)==41){t=4}else{if(u.src.charCodeAt(v)==60||u.src.charCodeAt(v)==62){t=5}else{if(u.src.charCodeAt(v)==34){t=11}else{if(u.src.charCodeAt(v)==79){t=12}else{if(u.src.charCodeAt(v)==32){t=13}else{if(u.src.charCodeAt(v)==61){t=14}else{if(u.src.charCodeAt(v)==65){t=18}else{if(u.src.charCodeAt(v)==78){t=19}else{t=-1}}}}}}}}}}}break;case 1:if((u.src.charCodeAt(v)>=0&&u.src.charCodeAt(v)<=31)||u.src.charCodeAt(v)==33||(u.src.charCodeAt(v)>=35&&u.src.charCodeAt(v)<=39)||(u.src.charCodeAt(v)>=42&&u.src.charCodeAt(v)<=57)||(u.src.charCodeAt(v)>=59&&u.src.charCodeAt(v)<=254)){t=1}else{if(u.src.charCodeAt(v)==58){t=6}else{t=-1}}i=10;s=v;break;case 2:if((u.src.charCodeAt(v)>=0&&u.src.charCodeAt(v)<=31)||u.src.charCodeAt(v)==33||(u.src.charCodeAt(v)>=35&&u.src.charCodeAt(v)<=39)||(u.src.charCodeAt(v)>=42&&u.src.charCodeAt(v)<=57)||(u.src.charCodeAt(v)>=59&&u.src.charCodeAt(v)<=254)){t=1}else{if(u.src.charCodeAt(v)==58){t=6}else{t=-1}}i=1;s=v;break;case 3:t=-1;i=3;s=v;break;case 4:t=-1;i=4;s=v;break;case 5:if(u.src.charCodeAt(v)==61){t=14}else{t=-1}i=11;s=v;break;case 6:t=-1;i=8;s=v;break;case 7:t=-1;i=9;s=v;break;case 8:if((u.src.charCodeAt(v)>=0&&u.src.charCodeAt(v)<=31)||u.src.charCodeAt(v)==33||(u.src.charCodeAt(v)>=35&&u.src.charCodeAt(v)<=39)||(u.src.charCodeAt(v)>=42&&u.src.charCodeAt(v)<=57)||(u.src.charCodeAt(v)>=59&&u.src.charCodeAt(v)<=254)){t=1}else{if(u.src.charCodeAt(v)==58){t=6}else{t=-1}}i=6;s=v;break;case 9:if((u.src.charCodeAt(v)>=0&&u.src.charCodeAt(v)<=31)||u.src.charCodeAt(v)==33||(u.src.charCodeAt(v)>=35&&u.src.charCodeAt(v)<=39)||(u.src.charCodeAt(v)>=42&&u.src.charCodeAt(v)<=57)||(u.src.charCodeAt(v)>=59&&u.src.charCodeAt(v)<=254)){t=1}else{if(u.src.charCodeAt(v)==58){t=6}else{t=-1}}i=5;s=v;break;case 10:if((u.src.charCodeAt(v)>=0&&u.src.charCodeAt(v)<=31)||u.src.charCodeAt(v)==33||(u.src.charCodeAt(v)>=35&&u.src.charCodeAt(v)<=39)||(u.src.charCodeAt(v)>=42&&u.src.charCodeAt(v)<=57)||(u.src.charCodeAt(v)>=59&&u.src.charCodeAt(v)<=254)){t=1}else{if(u.src.charCodeAt(v)==58){t=6}else{t=-1}}i=7;s=v;break;case 11:if(u.src.charCodeAt(v)==34){t=7}else{if((u.src.charCodeAt(v)>=0&&u.src.charCodeAt(v)<=33)||(u.src.charCodeAt(v)>=35&&u.src.charCodeAt(v)<=91)||(u.src.charCodeAt(v)>=93&&u.src.charCodeAt(v)<=254)){t=11}else{if(u.src.charCodeAt(v)==92){t=15}else{t=-1}}}break;case 12:if((u.src.charCodeAt(v)>=0&&u.src.charCodeAt(v)<=31)||u.src.charCodeAt(v)==33||(u.src.charCodeAt(v)>=35&&u.src.charCodeAt(v)<=39)||(u.src.charCodeAt(v)>=42&&u.src.charCodeAt(v)<=57)||(u.src.charCodeAt(v)>=59&&u.src.charCodeAt(v)<=81)||(u.src.charCodeAt(v)>=83&&u.src.charCodeAt(v)<=254)){t=1}else{if(u.src.charCodeAt(v)==58){t=6}else{if(u.src.charCodeAt(v)==82){t=8}else{t=-1}}}i=10;s=v;break;case 13:t=-1;i=1;s=v;break;case 14:t=-1;i=11;s=v;break;case 15:if((u.src.charCodeAt(v)>=0&&u.src.charCodeAt(v)<=254)){t=11}else{t=-1}break;case 16:if((u.src.charCodeAt(v)>=0&&u.src.charCodeAt(v)<=31)||u.src.charCodeAt(v)==33||(u.src.charCodeAt(v)>=35&&u.src.charCodeAt(v)<=39)||(u.src.charCodeAt(v)>=42&&u.src.charCodeAt(v)<=57)||(u.src.charCodeAt(v)>=59&&u.src.charCodeAt(v)<=67)||(u.src.charCodeAt(v)>=69&&u.src.charCodeAt(v)<=254)){t=1}else{if(u.src.charCodeAt(v)==58){t=6}else{if(u.src.charCodeAt(v)==68){t=9}else{t=-1}}}i=10;s=v;break;case 17:if((u.src.charCodeAt(v)>=0&&u.src.charCodeAt(v)<=31)||u.src.charCodeAt(v)==33||(u.src.charCodeAt(v)>=35&&u.src.charCodeAt(v)<=39)||(u.src.charCodeAt(v)>=42&&u.src.charCodeAt(v)<=57)||(u.src.charCodeAt(v)>=59&&u.src.charCodeAt(v)<=83)||(u.src.charCodeAt(v)>=85&&u.src.charCodeAt(v)<=254)){t=1}else{if(u.src.charCodeAt(v)==58){t=6}else{if(u.src.charCodeAt(v)==84){t=10}else{t=-1}}}i=10;s=v;break;case 18:if((u.src.charCodeAt(v)>=0&&u.src.charCodeAt(v)<=31)||u.src.charCodeAt(v)==33||(u.src.charCodeAt(v)>=35&&u.src.charCodeAt(v)<=39)||(u.src.charCodeAt(v)>=42&&u.src.charCodeAt(v)<=57)||(u.src.charCodeAt(v)>=59&&u.src.charCodeAt(v)<=77)||(u.src.charCodeAt(v)>=79&&u.src.charCodeAt(v)<=254)){t=1}else{if(u.src.charCodeAt(v)==58){t=6}else{if(u.src.charCodeAt(v)==78){t=16}else{t=-1}}}i=10;s=v;break;case 19:if((u.src.charCodeAt(v)>=0&&u.src.charCodeAt(v)<=31)||u.src.charCodeAt(v)==33||(u.src.charCodeAt(v)>=35&&u.src.charCodeAt(v)<=39)||(u.src.charCodeAt(v)>=42&&u.src.charCodeAt(v)<=57)||(u.src.charCodeAt(v)>=59&&u.src.charCodeAt(v)<=78)||(u.src.charCodeAt(v)>=80&&u.src.charCodeAt(v)<=254)){t=1}else{if(u.src.charCodeAt(v)==58){t=6}else{if(u.src.charCodeAt(v)==79){t=17}else{t=-1}}}i=10;s=v;break}v++}while(t>-1)}while(1>-1&&i==1);if(i>-1){u.att=u.src.substr(w,s-w);u.offset=s}else{u.att=new String();i=-1}return i}function q(s,H,I){var t=new Array();var D=new Array();var w=0;var G;var x;var y;var K;var z=new Function("","var offset; var src; var att;");var E=new z();var B=new Array(new Array(0,1),new Array(13,1),new Array(12,1),new Array(12,2),new Array(12,3),new Array(14,1),new Array(14,3),new Array(15,2),new Array(15,1),new Array(16,3),new Array(16,2),new Array(16,1),new Array(17,2),new Array(17,1),new Array(18,1),new Array(18,1));var v=new Array(new Array(7,5,3,7,8,8,11,10,10,12,9,13),new Array(19,0),new Array(19,-1),new Array(6,14,7,5,3,7,8,8,11,10,10,12,9,13,19,-2,4,-2),new Array(5,16,19,-5,7,-5,3,-5,8,-5,11,-5,10,-5,9,-5,6,-5,4,-5),new Array(3,7,8,8,11,10,10,12,9,13),new Array(19,-8,7,-8,3,-8,8,-8,11,-8,10,-8,9,-8,6,-8,5,-8,4,-8),new Array(7,5,3,7,8,8,11,10,10,12,9,13),new Array(3,7,8,8,11,10,10,12,9,13),new Array(19,-11,7,-11,3,-11,8,-11,11,-11,10,-11,9,-11,6,-11,5,-11,4,-11),new Array(10,12,9,13),new Array(19,-13,7,-13,3,-13,8,-13,11,-13,10,-13,9,-13,6,-13,5,-13,4,-13),new Array(19,-14,7,-14,3,-14,8,-14,11,-14,10,-14,9,-14,6,-14,5,-14,4,-14),new Array(19,-15,7,-15,3,-15,8,-15,11,-15,10,-15,9,-15,6,-15,5,-15,4,-15),new Array(7,5,3,7,8,8,11,10,10,12,9,13),new Array(19,-3,4,-3),new Array(7,5,3,7,8,8,11,10,10,12,9,13),new Array(19,-7,7,-7,3,-7,8,-7,11,-7,10,-7,9,-7,6,-7,5,-7,4,-7),new Array(4,23),new Array(19,-10,7,-10,3,-10,8,-10,11,-10,10,-10,9,-10,6,-10,5,-10,4,-10),new Array(19,-12,7,-12,3,-12,8,-12,11,-12,10,-12,9,-12,6,-12,5,-12,4,-12),new Array(19,-4,4,-4),new Array(19,-6,7,-6,3,-6,8,-6,11,-6,10,-6,9,-6,6,-6,4,-6),new Array(19,-9,7,-9,3,-9,8,-9,11,-9,10,-9,9,-9,6,-9,5,-9,4,-9));var A=new Array(new Array(13,1,12,2,14,3,15,4,16,6,17,9,18,11),new Array(),new Array(),new Array(12,15,14,3,15,4,16,6,17,9,18,11),new Array(),new Array(16,17,17,9,18,11),new Array(),new Array(12,18,14,3,15,4,16,6,17,9,18,11),new Array(16,19,17,9,18,11),new Array(),new Array(18,20),new Array(),new Array(),new Array(),new Array(12,21,14,3,15,4,16,6,17,9,18,11),new Array(),new Array(14,22,15,4,16,6,17,9,18,11),new Array(),new Array(),new Array(),new Array(),new Array(),new Array(),new Array());var F=new Array("begin'","WHITESPACE","WHITESPACE","LEFT_PARENTHESE","RIGHT_PARENTHESE","AND","OR","NOT","COLUMN","STRING","WORD","OPERATOR","search_text","begin","and_expression","boolean_expression","expression","value","string","$");E.offset=0;E.src=s;E.att=new String();if(!H){H=new Array()}if(!I){I=new Array()}t.push(0);D.push(0);y=l(E);while(true){G=25;for(var C=0;C<v[t[t.length-1]].length;C+=2){if(v[t[t.length-1]][C]==y){G=v[t[t.length-1]][C+1];break}}if(e&&t.length>0){d("\nState "+t[t.length-1]+"\n\tLookahead: "+F[y]+' ("'+E.att+'")\n\tAction: '+G+'\n\tSource: "'+E.src.substr(E.offset,30)+((E.offset+30<E.src.length)?"...":"")+'"\n\tStack: '+t.join()+"\n\tValue stack: "+D.join()+"\n")}if(G==25){if(e){d("Error detected: There is no reduce or shift on the symbol "+F[y])}w++;H.push(E.offset-E.att.length);I.push(new Array());for(var C=0;C<v[t[t.length-1]].length;C+=2){I[I.length-1].push(F[v[t[t.length-1]][C]])}var u=new Array();var J=new Array();for(var C=0;C<t.length;C++){u[C]=t[C];J[C]=D[C]}while(G==25&&y!=19){if(e){d("\tError recovery\nCurrent lookahead: "+F[y]+" ("+E.att+")\nAction: "+G+"\n\n")}if(y==-1){E.offset++}while(G==25&&t.length>0){t.pop();D.pop();if(t.length==0){break}G=25;for(var C=0;C<v[t[t.length-1]].length;C+=2){if(v[t[t.length-1]][C]==y){G=v[t[t.length-1]][C+1];break}}}if(G!=25){break}for(var C=0;C<u.length;C++){t.push(u[C]);D.push(J[C])}y=l(E)}if(G==25){if(e){d("\tError recovery failed, terminating parse process...")}break}if(e){d("\tError recovery succeeded, continuing")}}if(G>0){if(e){d("Shifting symbol: "+F[y]+" ("+E.att+")")}t.push(G);D.push(E.att);y=l(E);if(e){d("\tNew lookahead symbol: "+F[y]+" ("+E.att+")")}}else{G*=-1;if(e){d("Reducing by producution: "+G)}K=void (0);if(e){d("\tPerforming semantic action...")}switch(G){case 0:K=D[D.length-1];break;case 1:r=D[D.length-1];break;case 2:K=D[D.length-1];break;case 3:K=c("OR",[D[D.length-2],D[D.length-1]]);break;case 4:K=c("OR",[D[D.length-3],D[D.length-1]]);break;case 5:K=D[D.length-1];break;case 6:K=c("AND",[D[D.length-3],D[D.length-1]]);break;case 7:K=g(D[D.length-1]);break;case 8:K=D[D.length-1];break;case 9:K=D[D.length-2];break;case 10:j(D[D.length-1],D[D.length-2].split(":").slice(0,-1).join(":"));K=D[D.length-1];break;case 11:K=D[D.length-1];break;case 12:D[D.length-1].operator=D[D.length-2];K=D[D.length-1];break;case 13:K=D[D.length-1];break;case 14:K=k("",D[D.length-1]);break;case 15:K=k("",D[D.length-1].split('"').slice(1,-1).join('"'));break}if(e){d("\tPopping "+B[G][1]+" off the stack...")}for(var C=0;C<B[G][1];C++){t.pop();D.pop()}x=-1;for(var C=0;C<A[t[t.length-1]].length;C+=2){if(A[t[t.length-1]][C]==B[G][0]){x=A[t[t.length-1]][C+1];break}}if(G==0){break}if(e){d("\tPushing non-terminal "+F[B[G][0]])}t.push(x);D.push(K)}if(e){alert(n);n=new String()}}if(e){d("\nParse complete.");alert(n)}return w}var p=function(){var s,t,v=[],u=arguments;for(s=0;s<u.length;++s){for(t=0;t<u[s].length;++t){v.push(u[s][t])}}return v};var k=function(t,s,i){return{type:"simple",operator:"=",id:t,value:s}};var g=function(i){if(i.operator==="NOT"){return i.query_list[0]}return{type:"complex",operator:"NOT",query_list:[i]}};var c=function(t,v){var u,s=[];for(u=0;u<v.length;++u){if(v[u].operator===t){s=p(s,v[u].query_list)}else{s.push(v[u])}}return{type:"complex",operator:t,query_list:s}};var j=function(t,u){var s;if(t.type==="complex"){for(s=0;s<t.query_list.length;++s){j(t.query_list[s],u)}return true}if(t.type==="simple"&&!t.id){t.id=u;return true}return false};var o=[];var b=[];var f=0;var r;if((f=q(m,o,b))>0){var h;for(h=0;h<f;++h){throw new Error('Parse error near "'+m.substr(o[h])+'", expecting "'+b[h].join()+'"')}}return r}});Object.defineProperty(a.ComplexQueries,"serialize",{configurable:false,enumerable:false,writable:false,value:function(d){var b=[],c;if(d.type==="complex"){b.push("(");for(c=0;c<d.query_list.length;++c){b.push(a.ComplexQueries.serialize(d.query_list[c]));b.push(d.operator)}b.length--;b.push(")");return b.join(" ")}else{if(d.type==="simple"){return d.id+(d.id?": ":"")+d.operator+' "'+d.value+'"'}}return d}});Object.defineProperty(a.ComplexQueries,"query",{configurable:false,enumerable:false,writable:false,value:function(i,h){var k=typeof i.wildcard_character==="string"?i.wildcard_character:"%",l={"=":function(r,j){r=""+r;return r.match(b(j,k))||false&&true},"!=":function(r,j){r=""+r;return !(r.match(b(j,k)))},"<":function(r,j){return r<j},"<=":function(r,j){return r<=j},">":function(r,j){return r>j},">=":function(r,j){return r>=j},AND:function(s,r){var j;for(j=0;j<r.length;++j){if(!p(s,r[j])){return false}}return true},OR:function(s,r){var j;for(j=0;j<r.length;++j){if(p(s,r[j])){return true}}return false},NOT:function(r,j){return !p(r,j[0])}},b=function(j){return f("^"+j.replace(new RegExp("([\\{\\}\\(\\)\\^\\$\\&\\.\\*\\?\\/\\+\\|\\[\\]\\-\\\\])".replace(k?"\\"+k:undefined,""),"g"),"\\$1")+"$",(k||undefined),".*")},f=function(j,u,v){var t="",s=0;if(u===undefined){return j}while(1){var r=j.indexOf(u,s);if(r===-1){break}for(;s<r;++s){t+=j[s]}t+=v;s+=u.length}for(;s<j.length;++s){t+=j[s]}return t},p=function(r,s){var j;if(s.type==="complex"){return l[s.operator](r,s.query_list)}else{if(s.id){if(typeof r[s.id]!=="undefined"){return l[s.operator](r[s.id],s.value)}else{return false}}else{return true}}},m=function(t,u){var r;if(u.length===0){return}for(r=0;r<t.length;++r){var s={},j;for(j=0;j<u.length;++j){s[u[j]]=t[r][u[j]]}t[r]=s}},o=function(j,r){if(r==="descending"){return function(t,s){return t[j]<s[j]?1:t[j]>s[j]?-1:0}}return function(t,s){return t[j]>s[j]?1:t[j]<s[j]?-1:0}},g=function(u,v,s){var t,r;for(t=s,r=0;t<v.length+s;++t,++r){u[t]=v[r]}},e=function(w,t){var s,r,j,v,u=function(){e(r,t.slice(1));g(w,r,s-r.length);r=[w[s]]};if(w.length<2){return}if(t.length===0){return}j=t[0][0];v=t[0][1];w.sort(o(j,v));r=[w[0]];for(s=1;s<w.length;++s){if(r[0][j]===w[s][j]){r.push(w[s])}else{u()}}u()},c=function(r,s){var j;if(typeof s[0]!=="undefined"){if(typeof s[1]!=="undefined"){if(r.length>s[1]+s[0]){r.length=s[1]+s[0]}r.splice(0,s[0])}else{r.length=s[0]}}},n=[],q=[],d;h=h||[];if(i.query===undefined){n=h}else{for(d=0;d<h.length;++d){if(p(h[d],a.ComplexQueries.parse(i.query))){n.push(h[d])}}}if(i.filter){m(n,i.filter.select_list||[]);e(n,i.filter.sort_on||[]);c(n,i.filter.limit||[])}return n}})}(jIO));